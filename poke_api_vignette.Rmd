---
title: "Poke API Vignette"
author: "Evan Patton"
date: "9/27/2021"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(eval = TRUE, echo = TRUE, message = FALSE, warning = FALSE)
```


## Introduction

This space reserved for introduction, talk about the project, my thoughts, and then an overview of my work.



## Packages Needed

In this Vignette we will need the following packages:

```{r packages}
# You only need to run the install.packages() functions if you have not already downloaded the packages. 
# As I already have them downloaded, I am not doing that here. If you need to, copy and paste the line needed, without the #, into your console and run.

# install.packages("tidyverse")
# install.packages("httr")
# install.packages("jsonlite")

library(httr)
library(jsonlite)
library(tidyverse)
```

## Encounter Function

Pokemon fans around the world, myself included, know the catch phrase from the TV show by heart. **"Gotta Catch 'em All"**.
That speaks to a major part of both the Pokemon TV shows and the video games, which is collecting all the different Pokemon from around the fictional world and filling up your PokeDex with their information.

However, before you can catch 'em, you gotta find 'em. That is the purpose of this function is to find what locations in games you can find Pokemon in the wild. It will also return the chance of encountering the Pokemon there, the minimum level, the maximum level, and how you would encounter the Pokemon (walking in tall grass vs being given as a gift as an example.)


The function `encounter` is built below and an example will be shown later. `encounter` takes two arguments, the first one is not optional, and that is the Pokemon you want to find. The second argument is optional, and that is what game from the series you want to return data on, if no game is selected then all games will be returned in the final tibble. **Both arguments require quoted strings**

```{r encounter_func}

# Starting the function
encounter <- function(poke, game = "all") {

# Converting inputs to lower case for flexability
poke <- tolower(poke)
game <- tolower(game)

# Get the requested data   
raw_data <- fromJSON(paste0("https://pokeapi.co/api/v2/pokemon/",poke,"/encounters"), flatten = TRUE)


# Start loops.
# Beginning of location loop.
for (i in 1:dim(raw_data)[1]) {
  
  # Get the location from raw.
  loc <- raw_data[i,2]
  
  # Beginning of game loop.
  for (b in 1:dim(raw_data[[1]][[i]])[1]){
    
    # Get the specific game from raw.
    gm <- raw_data[[1]][[i]][b,3]
    
    # Beginning of details loop.
    for (a in 1:dim(raw_data[[1]][[i]][[1]][[b]])[1]){
      
      # Get the chance, max level, min level, and method.
      chance <- raw_data[[1]][[i]][[1]][[b]][a,1]
      max    <- raw_data[[1]][[i]][[1]][[b]][a,3]
      min    <- raw_data[[1]][[i]][[1]][[b]][a,4]
      meth   <- raw_data[[1]][[i]][[1]][[b]][a,5]
      
      # Combine all vars into a line for tibble creation
      line   <- c(loc,gm,chance,max,min,meth)
         
      # Build dfd tibble.
      # If this is the first iteration of the details loop
      # then dfd is created with all of the vars.
      # If not first iteration, bind dfd with line to add another line to dfd.
      if(a == 1){
        dfd <- tibble(loc,gm,chance,max,min,meth)
      } else{
          dfd <- rbind(dfd,line)
        } # Close if else statement.
      } # Close details loop.
  
    # Build dfg tibble.
    # If first iteration of game loop, dfg is dfd.
    # If not first iteration, dfg is binded with dfd to add more lines.
    if(b == 1)
    {dfg <- dfd
    }else{
      dfg <- rbind(dfg,dfd)
    } # Close if else statement
    } # Close game loop
    
  # Create final tibble
  # If first iteration of location loop, dfl is the final dfg from the game loop.
  # If not first iteration, dfl is binded with the most recent dfg to add more lines.
  if(i==1){
    dfl <- dfg
  }else{
    dfl <- rbind(dfl,dfg)
  } # End if else statement
  } # End location loop
# End of all loops

# Rename variables in final dfl.
names(dfl) <- c("Location","Game","Chance","Max_Level","Min_Level","Method")

# Keep only distinct rows, as there are some that repeat due to variables 
# not important for this function.
dfl <- distinct(dfl)

# If user doesn't input an option for game or wants all games, dfl is returned.
# If user does input an option for game, then dfl is filtered for that game and returned.
if(game == "all"){
   return(dfl)
}else{
    return(dfl %>%
             filter(Game == game))
  } # End of if else statement.

} # Close of function
```



Here we test the encounter function with my favorite starter Pokemon **CHARMANDER**.

```{r ecounter example}

charmander <- encounter("charmander")

print(charmander)


```






